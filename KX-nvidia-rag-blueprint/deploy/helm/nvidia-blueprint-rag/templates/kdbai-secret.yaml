{{- if .Values.kdbai.enabled }}
# KDB.AI License Secret
# This secret holds the base64-encoded KDB.AI license from KX
{{- if .Values.kdbai.licenseSecret.create }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.kdbai.licenseSecret.name }}
  labels:
    {{- include "nvidia-blueprint-rag.labels" . | nindent 4 }}
    app.kubernetes.io/component: kdbai
type: Opaque
data:
  # KDB.AI license must be base64-encoded
  # The value here is base64-encoded twice: once for the license format, once for K8s secret
  KDB_LICENSE_B64: {{ .Values.kdbai.licenseSecret.licenseB64 | b64enc | quote }}
{{- end }}
---
# KDB.AI Docker Registry Secret
# This secret authenticates with the KX Docker registry (portal.dl.kx.com)
{{- if .Values.kdbai.imagePullSecret.create }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.kdbai.imagePullSecret.name }}
  labels:
    {{- include "nvidia-blueprint-rag.labels" . | nindent 4 }}
    app.kubernetes.io/component: kdbai
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: {{ printf `{"auths":{"%s":{"username":"%s","password":"%s","email":"%s","auth":"%s"}}}` "portal.dl.kx.com" .Values.kdbai.imagePullSecret.email .Values.kdbai.imagePullSecret.token .Values.kdbai.imagePullSecret.email (printf "%s:%s" .Values.kdbai.imagePullSecret.email .Values.kdbai.imagePullSecret.token | b64enc) | b64enc | quote }}
{{- end }}
{{- end }}
